<template>
  <div class="page">
    <!-- Stepper -->
    <section class="stepper" aria-label="progress">
      <div class="stepper__item" :class="{ 'is-active': currentStep >= 1 }">
        <div class="dot">1</div>
        <div class="label">사진 업로드</div>
      </div>
      <div class="connector"></div>
      <div class="stepper__item" :class="{ 'is-active': currentStep >= 2 }">
        <div class="dot">2</div>
        <div class="label">문구 입력</div>
      </div>
      <div class="connector"></div>
      <div class="stepper__item" :class="{ 'is-active': currentStep >= 3 }">
        <div class="dot">3</div>
        <div class="label">스타일 선택</div>
      </div>
      <div class="connector"></div>
      <div class="stepper__item" :class="{ 'is-active': currentStep >= 4 }">
        <div class="dot">4</div>
        <div class="label">콘텐츠 생성</div>
      </div>
    </section>

    <!-- Title -->
    <h1 class="title" v-if="currentStep === 1">1단계: 사진을 업로드해주세요</h1>
    <h1 class="title" v-else-if="currentStep === 2">2단계: 표현하고 싶은 문구를 입력해주세요</h1>
    <h1 class="title" v-else-if="currentStep === 3">3단계: 업로드 전에 편집해주세요</h1>
    <h1 class="title" v-else-if="currentStep === 4">4단계: 완성된걸 업로드하세요</h1>

    <!-- STEP 1: Upload area -->
    <section class="upload-section" v-if="currentStep === 1">
      <div class="upload-drop" @drop.prevent="handleDrop" @dragover.prevent>
        <input
          type="file"
          ref="fileInput"
          accept="image/jpeg,image/png"
          @change="handleFileChange"
          hidden
        />
        <button class="upload-inner" type="button" @click="openPicker">
          <svg
            class="cloud"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            aria-hidden="true"
          >
            <path
              d="M7 18h10a4 4 0 0 0 0-8 6 6 0 0 0-11.31-2A4.5 4.5 0 0 0 5 18"
              stroke="#9AA0A6"
              stroke-width="1.6"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M12 13v6m0-6-2.5 2.5M12 13l2.5 2.5"
              stroke="#9AA0A6"
              stroke-width="1.6"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <p class="upload-text-1">사진을 드래그하거나 클릭해서 업로드하세요</p>
          <p class="upload-text-2">JPG, PNG 파일 지원 (최대 10MB)</p>
          <p class="upload-text-3">제품, 음식, 풍경, 인물 등 모든 사진 가능</p>
        </button>
      </div>
    </section>

    <!-- STEP 2: Caption input + live preview (two-column) -->
    <section class="step2" v-if="currentStep === 2">
      <div class="step2__grid">
        <!-- Left column -->
        <div class="col-left">
          <!-- Uploaded info box -->
          <div class="uploaded-box">
            <div class="uploaded-box__header">
              <span class="check-dot" aria-hidden>•</span>
              <strong>1단계 완료: 사진 업로드됨</strong>
            </div>
            <div class="uploaded-box__body">
              <div class="thumb" v-if="uploadedUrls[0]">
                <img :src="uploadedUrls[0]" alt="업로드된 사진" />
              </div>
              <div class="thumb-placeholder" v-else>썸네일</div>
              <div class="meta">
                <div class="meta-title">업로드된 사진</div>
                <button type="button" class="link-change" @click="backToUpload">
                  사진 변경하기
                </button>
              </div>
            </div>
          </div>

          <!-- Caption input -->
          <div class="field">
            <label class="field__label">문구 입력 <span class="required">*</span></label>
            <div class="textarea-wrap">
              <textarea
                v-model="userCaption"
                class="textarea"
                :maxlength="100"
                placeholder="입력해주세요"
              ></textarea>
              <button
                class="clear-btn"
                type="button"
                v-if="userCaption"
                @click="userCaption = ''"
                aria-label="clear"
              >
                ×
              </button>
            </div>
            <div class="field__meta">
              <span class="agree"><span class="dot" /> 숨습니다</span>
              <span class="count">{{ userCaption.length }}/100</span>
            </div>
          </div>

          <!-- Tips -->
          <div class="tips">
            <div class="tips__title">작성 팁</div>
            <ul class="tips__list">
              <li>감정이나 상황을 간단히 표현해보세요</li>
              <li>너무 길지 않게 핵심만 담아주세요</li>
              <li>AI가 이틀 배운으로 매력적인 콘텐츠를 생성합니다</li>
              <li>개인적인 취향이나 느낌을 포함하면 더 좋아요</li>
            </ul>
          </div>
        </div>

        <!-- Right column: live preview -->
        <div class="col-right">
          <div class="preview-card">
            <div class="preview-card__title">
              <span class="eye" aria-hidden>👁️</span> 실시간 미리보기
            </div>
            <div class="preview-canvas">
              <div class="preview-badge">?????</div>
            </div>
            <div class="preview-footer">
              <div class="preview-label">입력한 문구:</div>
              <div class="preview-text">{{ userCaption || '안녕하세요!!!!!' }}</div>
              <p class="preview-help">
                AI가 이 문구를 바탕으로 매력적인 인스타그램 콘텐츠를 생성합니다
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- STEP 3: AI 문구 확인/편집 -->
    <section class="step3" v-if="currentStep === 3">
      <!-- top summary card for steps 1-2 -->
      <div class="step3-topbox">
        <div class="left">
          <div class="badge-line">
            <span class="check-dot">•</span>
            <strong>1-2단계 완료</strong>
          </div>
          <div class="upload-mini">
            <div class="thumb" v-if="uploadedUrls[0]">
              <img :src="uploadedUrls[0]" alt="업로드된 사진" />
            </div>
            <div class="thumb thumb--ph" v-else>썸네일</div>
            <div class="meta">
              <div class="meta-title">업로드된 사진</div>
            </div>
          </div>
        </div>
        <div class="right">
          <div class="input-preview">
            <div class="label">입력 문구</div>
            <div class="bubble">{{ userCaption || '오늘의 특별한 순간' }}</div>
          </div>
        </div>
      </div>

      <h2 class="h3">3단계: AI가 생성한 문구를 확인하고 편집해보세요</h2>

      <div class="ai-card-wrapper">
        <button class="back-fab" type="button" @click="currentStep = 2" aria-label="go back">
          ‹
        </button>
        <div class="ai-card">
          <div class="ai-card__header">
            <div class="title"><span class="red-dot" /> AI 생성 문구</div>
            <div class="actions">
              <button class="btn-edit" type="button" @click="openEditModal">편집하기</button>
              <button class="btn-restore" type="button" @click="restoreOriginal">
                원본으로 복원
              </button>
            </div>
          </div>
          <div class="ai-card__body">
            <div class="ai-output">{{ generatedText }}</div>
          </div>
          <div class="ai-card__foot">
            <span class="warn-dot" /> 마음에 들지 않으면 편집하기 버튼을 눌러 수정해주세요
          </div>
        </div>
      </div>
    </section>

    <!-- STEP 4: 최종 결과 -->
     <br>
    <section class="step4" v-if="currentStep === 4">
      <div class="step4__grid">
        <!-- Left: Final content card -->
        <div class="final-left">
          <div class="final-box">
            <div class="final-box__title"><span class="red-icon" /> 최종 생성된 콘텐츠</div>
            <div class="final-box__body">
              <div class="final-caption">
                <div class="final-caption__header"><span class="green-dot" /> 완성된 캡션</div>
                <div class="final-caption__inner">
                  <div class="final-caption__title">✨ 오늘의 특별한 순간 ✒️</div>
                  <div class="final-caption__text">
                    {{ generatedText || buildAiText(userCaption) }}
                  </div>
                </div>
              </div>

              <div class="final-hashtags">
                <div class="hash-title"><span class="hash-icon" /> 추천 해시태그</div>
                <div class="hash-bubble">
                  #오늘의특별한순간 #일상 #소중한순간 #행복 #감사 #일상스타그램 #데일리 #좋은하루
                </div>
              </div>

              <div class="final-metrics">
                <div class="metric">
                  <div class="metric-label"><span class="clock-icon" /> 최적 게시 시간</div>
                  <div class="metric-value">오후 7-9시 (한국시간대)</div>
                </div>
                <div class="metric">
                  <div class="metric-label"><span class="spark-icon" /> 예상 효과</div>
                  <div class="metric-value">예상 도달률: 85% 향상</div>
                </div>
              </div>
            </div>
          </div>

          <div class="other-style"><span class="star">★</span> 다른 스타일 버전</div>
        </div>

        <!-- Right: Final preview & download -->
        <div class="final-right">
          <div class="result-card">
            <div class="result-card__title"><span class="eye" /> 최종 결과물</div>
            <div class="result-canvas">
              <div class="canvas-ph"></div>
            </div>
            <div class="result-footer">
              <div class="orig-label">원본 문구:</div>
              <div class="orig-value link">{{ userCaption || '오늘의 특별한 순간' }}</div>
              <div class="result-note">
                <span class="info-icon" /> 이미지를 클릭하면 인스타그램 미리보기를 볼 수 있어요
              </div>
            </div>
          </div>

          <div class="download-row">
            <div class="download-left"><span class="dl-icon" /> 다운로드 & 공유</div>
            <button class="download-btn" type="button">
              <span class="btn-icon" /> 이미지 다운로드
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <div class="footer">
      <button v-if="currentStep === 1" class="next-btn" @click="goToStep2">다음</button>
      <button v-else-if="currentStep === 2" class="next-btn" @click="goToStep3">다음</button>
      <button v-else-if="currentStep === 3" class="next-btn" @click="goToStep4">다음</button>
      <button v-else class="next-btn" disabled>업로드하기</button>
    </div>

    <!-- Edit Modal -->
    <div v-if="showEditModal" class="modal-overlay" @click.self="closeEditModal">
      <div class="modal">
        <div class="modal-header">
          <strong>문구 편집</strong>
          <button class="modal-close" type="button" @click="closeEditModal">×</button>
        </div>
        <div class="modal-body">
          <div class="modal-img">
            <img v-if="uploadedUrls[0]" :src="uploadedUrls[0]" alt="미리보기" />
            <div v-else class="modal-img-ph">이미지 없음</div>
          </div>
          <div class="modal-form">
            <textarea v-model="editBuffer" class="modal-textarea"></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn-primary" type="button" @click="saveEdit">저장</button>
          <button class="btn-secondary" type="button" @click="closeEditModal">닫기</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const currentStep = ref(1);
const uploadedUrls = ref([]); // 여러 장 지원 대비
const fileInput = ref(null);
const userCaption = ref('안녕하세요!!!!!');

const generatedText = ref('');
const originalGeneratedText = ref('');
const showEditModal = ref(false);
const editBuffer = ref('');

function openPicker() {
  fileInput.value?.click();
}

function handleFileChange(e) {
  const file = e.target.files?.[0];
  if (file) uploadTemp(file);
  e.target.value = '';
}
function handleDrop(e) {
  const file = e.dataTransfer.files?.[0];
  if (file) uploadTemp(file);
}

async function uploadTemp(file) {
  try {
    if (!/image\/(jpeg|png)/.test(file.type)) return alert('JPG, PNG만 업로드 가능');
    if (file.size > 10 * 1024 * 1024) return alert('최대 10MB까지 가능');

    const presign = await getTempPresign(file.name, file.type); // { url, key, publicUrl }
    const putRes = await fetch(presign.url, {
      method: 'PUT',
      headers: { 'Content-Type': file.type },
      body: file,
    });
    if (!putRes.ok) throw new Error(`S3 업로드 실패: ${putRes.status}`);

    const finalUrl = presign.publicUrl ?? presign.url.split('?')[0];
    uploadedUrls.value.push(finalUrl);
    alert('임시 업로드 완료!');
  } catch (e) {
    console.error(e);
    alert('업로드 실패');
  }
}

function goToStep2() {
  currentStep.value = 2;
}

function backToUpload() {
  currentStep.value = 1;
}

function goToStep3() {
  currentStep.value = 3;
  if (!generatedText.value) {
    const t = buildAiText(userCaption.value);
    generatedText.value = t;
    originalGeneratedText.value = t;
  }
}

function goToStep4() {
  currentStep.value = 4;
}

function buildAiText(caption) {
  const seed = caption && caption.trim() ? caption.trim() : '오늘의 특별한 순간';
  return `✨ ${seed} ✨\n\n매일 반복되는 일상 속에서도 이런 특별한 순간들이 있어서 참 감사해요! 작은 것에서 행복을 찾는 하루하루가 소중하다는 걸 다시 한번 느껴봅니다😊\n\n여러분도 오늘 어떤 특별한 순간을 만났나요? 댓글로 공유해주세요!\n\n#오늘의특별한순간 #일상 #소중한순간 #행복 #감사 #데일리 #좋은하루`;
}

function openEditModal() {
  editBuffer.value = generatedText.value;
  showEditModal.value = true;
}
function closeEditModal() {
  showEditModal.value = false;
}
function saveEdit() {
  generatedText.value = editBuffer.value;
  showEditModal.value = false;
}
function restoreOriginal() {
  generatedText.value = originalGeneratedText.value;
}

async function generate() {
  if (!uploadedUrls.value.length) return alert('이미지를 먼저 올려주세요.');
  try {
    const result = await createCaptionsFromUrls({
      s3Urls: uploadedUrls.value,
      options: {
        language: 'ko',
        withHashtags: true,
        withEmojis: false,
        variations: 3,
        maxChars: 200,
      },
    });
    console.log('캡션 결과:', result);
  } catch (e) {
    console.error(e);
    alert('캡션 생성 실패');
  }
}
</script>

<style scoped>
/* Global layout */
.page {
  width: 100%;
  min-height: 100vh;
  background: #ffffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-family:
    -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Noto Sans KR', system-ui, sans-serif;
  color: #202124;
}

/* Stepper */
.stepper {
  margin-top: 40px;
  display: grid;
  grid-template-columns: auto 80px auto 80px auto 80px auto;
  align-items: center;
  gap: 0;
}
.stepper .connector {
  height: 2px;
  background: #d6d9dc;
  width: 80px;
}
.stepper__item {
  text-align: center;
}
.stepper__item .dot {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: #e5e7eb;
  color: #555;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 16px;
}
.stepper__item .label {
  margin-top: 8px;
  font-size: 14px;
  color: #6f7275;
}
.stepper__item.is-active .dot {
  background: #ff6b6b;
  color: #fff;
}

/* Title */
.title {
  margin-top: 36px;
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

/* Upload section */
.upload-section {
  width: 940px;
  max-width: calc(100% - 48px);
  margin-top: 24px;
}
.upload-drop {
  border: 2px dashed #d9d9d9;
  border-radius: 12px;
  height: 380px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fff;
}
.upload-inner {
  appearance: none;
  background: transparent;
  border: none;
  cursor: pointer;
  text-align: center;
}
.cloud {
  display: block;
  margin: 0 auto 16px;
}
.upload-text-1 {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  color: #3c4043;
}
.upload-text-2 {
  margin: 10px 0 0 0;
  font-size: 14px;
  color: #6f7275;
}
.upload-text-3 {
  margin: 12px 0 0 0;
  font-size: 14px;
  color: #ff6b6b;
}

/* STEP2 Grid */
.step2 {
  width: 940px;
  max-width: calc(100% - 48px);
  margin-top: 16px;
}
.step2__grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  align-items: start;
}

/* Uploaded info box */
.uploaded-box {
  border: 1px solid #f2d7cc;
  background: #fff7f3;
  border-radius: 8px;
  padding: 16px;
}
.uploaded-box__header {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #333;
  margin-bottom: 12px;
}
.check-dot {
  width: 18px;
  height: 18px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: #ff6b6b;
  color: #fff;
  font-weight: 700;
}
.uploaded-box__body {
  display: flex;
  gap: 12px;
  align-items: center;
}
.thumb {
  width: 44px;
  height: 44px;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid #f0e0da;
  background: #fff;
  flex: 0 0 auto;
}
.thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.thumb-placeholder {
  width: 44px;
  height: 44px;
  border-radius: 6px;
  background: #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #9aa0a6;
  font-size: 12px;
}
.meta {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.meta-title {
  font-size: 13px;
  color: #666;
}
.link-change {
  appearance: none;
  background: none;
  border: none;
  color: #ff6b6b;
  font-size: 12px;
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
}

/* Field */
.field {
  margin-top: 24px;
}
.field__label {
  font-size: 14px;
  font-weight: 600;
}
.required {
  color: #ff6b6b;
}
.textarea-wrap {
  position: relative;
}
.textarea {
  width: 100%;
  height: 140px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px 36px 12px 12px;
  font-size: 14px;
  resize: none;
}
.clear-btn {
  position: absolute;
  right: 8px;
  top: 8px;
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  background: #fff;
  cursor: pointer;
}
.field__meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 6px;
  font-size: 12px;
  color: #6f7275;
}
.field__meta .dot {
  width: 6px;
  height: 6px;
  background: #ff6b6b;
  display: inline-block;
  border-radius: 999px;
  margin-right: 6px;
}
.count {
  color: #9aa0a6;
}

/* Tips */
.tips {
  margin-top: 16px;
  border: 1px solid #f2d7cc;
  background: #fff7f3;
  border-radius: 8px;
  padding: 14px;
}
.tips__title {
  font-weight: 700;
  margin-bottom: 8px;
  font-size: 14px;
}
.tips__list {
  margin: 0;
  padding-left: 18px;
}
.tips__list li {
  margin: 4px 0;
  font-size: 13px;
  color: #5f6368;
}

/* Preview card */
.col-right {
}
.preview-card {
  border: 1px solid #f2d7cc;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
}
.preview-card__title {
  padding: 10px 12px;
  border-bottom: 1px solid #f2d7cc;
  background: #fff7f3;
  font-size: 13px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 6px;
}
.preview-canvas {
  height: 420px;
  background: #f6e6db;
  display: flex;
  align-items: center;
  justify-content: center;
}
.preview-badge {
  font-size: 28px;
  letter-spacing: 6px;
  padding: 6px 10px;
  border: 2px solid #ff9f8a;
  color: #ff695d;
  border-radius: 4px;
}
.preview-footer {
  padding: 12px;
  border-top: 1px solid #f2d7cc;
}
.preview-label {
  font-size: 12px;
  color: #6f7275;
  margin-bottom: 6px;
}
.preview-text {
  font-weight: 700;
  color: #ff6b6b;
}
.preview-help {
  margin-top: 6px;
  font-size: 11px;
  color: #9aa0a6;
}

/* Footer button */
.footer {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 28px 0 60px;
}
.next-btn {
  width: 360px;
  height: 48px;
  border-radius: 999px;
  border: none;
  font-weight: 600;
  font-size: 16px;
  color: #fff;
  background: #bfc3c7;
}
.next-btn:disabled {
  opacity: 1;
  cursor: not-allowed;
}

/* STEP3 */
.step3 {
  width: 940px;
  max-width: calc(100% - 48px);
  margin-top: 16px;
  font-family: 'Noto Sans KR', sans-serif;
}
.step3-topbox {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border: 1.2px solid #fbd2c6;
  background: #fff8f6;
  border-radius: 12px;
  padding: 20px;
  font-family: 'Noto Sans KR', sans-serif;
}
.step3-topbox .badge-line {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}
.step3-topbox .check-dot {
  width: 18px;
  height: 18px;
  border-radius: 999px;
  background: #ff6b6b;
  color: #fff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 13px;
}
.step3-topbox .upload-mini {
  display: flex;
  align-items: center;
  gap: 12px;
}
.step3-topbox .thumb {
  width: 44px;
  height: 44px;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid #f0e0da;
  background: #fff;
  flex: 0 0 auto;
}
.step3-topbox .thumb--ph {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #9aa0a6;
  font-size: 12px;
}
.step3-topbox .meta {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.step3-topbox .meta-title {
  font-size: 13px;
  color: #666;
}
.input-preview {
  display: flex;
  align-items: center;
  gap: 10px;
  font-family: 'Noto Sans KR', sans-serif;
}
.input-preview .label {
  font-size: 12px;
  color: #6f7275;
  margin-right: 2px;
}
.input-preview .bubble {
  background: #fff;
  border: 1.2px solid #ff6b6b;
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 8px;
  font-weight: 600;
  color: #ff6b6b;
  font-family: 'Noto Sans KR', sans-serif;
  line-height: 1.5;
  box-sizing: border-box;
}
.h3 {
  margin: 18px 0;
  font-size: 18px;
  font-weight: 700;
  font-family: 'Noto Sans KR', sans-serif;
}

.ai-card-wrapper {
  position: relative;
}
.back-fab {
  position: absolute;
  left: -22px;
  top: 44px;
  width: 36px;
  height: 36px;
  border-radius: 999px;
  border: 1.2px solid #fbd2c6;
  background: #fff;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
}
.ai-card {
  border: 1.2px solid #eaeaea;
  border-radius: 12px;
  background: #fff;
  overflow: hidden;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
  font-family: 'Noto Sans KR', sans-serif;
}
.ai-card__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 1px solid #f2d7cc;
  background: #fff;
  font-size: 15px;
  font-weight: 700;
  font-family: 'Noto Sans KR', sans-serif;
}
.ai-card__header .title {
  font-weight: 700;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: 'Noto Sans KR', sans-serif;
}
.red-dot {
  width: 8px;
  height: 8px;
  background: #ff6b6b;
  display: inline-block;
  border-radius: 999px;
}
.actions {
  display: flex;
  gap: 8px;
}
.btn-edit {
  background: #ff6b6b;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  padding: 6px 12px;
  font-family: 'Noto Sans KR', sans-serif;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.12s;
}
.btn-edit:hover,
.btn-edit:focus {
  background: #ff4545;
}
.btn-restore {
  background: #fff;
  border: 1px solid #ccc;
  color: #666;
  border-radius: 6px;
  font-size: 13px;
  padding: 6px 12px;
  font-family: 'Noto Sans KR', sans-serif;
  font-weight: 500;
  cursor: pointer;
  transition: border 0.12s;
}
.btn-restore:hover,
.btn-restore:focus {
  border-color: #ff6b6b;
  color: #ff6b6b;
}
.ai-card__body {
  padding: 18px 18px 18px 18px;
  background: #fff;
}
.ai-output {
  background: #fff;
  border: 1px solid #eee;
  border-radius: 8px;
  padding: 18px;
  font-size: 14px;
  line-height: 1.8;
  color: #333;
  white-space: pre-wrap;
  font-family: 'Noto Sans KR', sans-serif;
  box-sizing: border-box;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
}
.ai-card__foot {
  padding: 12px 16px;
  border-top: none;
  background: #fafafa;
  font-size: 12px;
  color: #999;
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: 'Noto Sans KR', sans-serif;
}
.warn-dot {
  width: 8px;
  height: 8px;
  background: #ff6b6b;
  display: inline-block;
  border-radius: 999px;
}

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  font-family: 'Noto Sans KR', sans-serif;
}
.modal {
  width: 720px;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  font-family: 'Noto Sans KR', sans-serif;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid #eee;
  font-family: 'Noto Sans KR', sans-serif;
}
.modal-close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}
.modal-body {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 12px;
  padding: 16px;
  font-family: 'Noto Sans KR', sans-serif;
}
.modal-img {
  border: 1px solid #f0e0da;
  border-radius: 8px;
  overflow: hidden;
  background: #fff7f3;
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.modal-img-ph {
  color: #9aa0a6;
  font-size: 12px;
  padding: 20px;
}
.modal-form {
}
.modal-textarea {
  width: 100%;
  height: 240px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  resize: vertical;
  font-size: 14px;
  line-height: 1.6;
  font-family: 'Noto Sans KR', sans-serif;
  color: #222;
}
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid #eee;
}
.btn-primary {
  background: #ff6b6b;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
}
.btn-secondary {
  background: #f3f4f6;
  color: #333;
  border: 1px solid #e5e7eb;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
}

/* STEP4 */
.step4 {
  width: 100%;
  display: flex;
  justify-content: center;
}
.step4__grid {
  width: 940px;
  max-width: calc(100% - 48px);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  align-items: start;
}
.final-box {
  border: 1.2px solid #f3bfb2;
  border-radius: 12px;
  background: #fff;
  overflow: hidden;
}
.final-box__title {
  padding: 12px 16px;
  font-weight: 700;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 1px solid #f3d9cf;
  background: #fff;
}
.red-icon {
  width: 10px;
  height: 10px;
  background: #ff6b6b;
  border-radius: 999px;
  display: inline-block;
}
.final-box__body {
  padding: 14px;
}
.final-caption {
  border: 1px solid #f3d9cf;
  background: #fff7f3;
  border-radius: 8px;
}
.final-caption__header {
  padding: 8px 10px;
  font-size: 12px;
  color: #666;
  display: flex;
  align-items: center;
  gap: 6px;
  border-bottom: 1px solid #f3d9cf;
}
.green-dot {
  width: 8px;
  height: 8px;
  background: #ff9f8a;
  border-radius: 999px;
  display: inline-block;
}
.final-caption__inner {
  padding: 12px;
}
.final-caption__title {
  font-weight: 700;
  margin-bottom: 8px;
  color: #333;
}
.final-caption__text {
  white-space: pre-wrap;
  line-height: 1.8;
  color: #333;
  font-size: 14px;
}
.final-hashtags {
  margin-top: 12px;
}
.hash-title {
  font-weight: 700;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}
.hash-icon {
  width: 8px;
  height: 8px;
  background: #ff6b6b;
  display: inline-block;
  border-radius: 999px;
}
.hash-bubble {
  border: 1px solid #f3d9cf;
  background: #fff;
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 13px;
  color: #444;
}
.final-metrics {
  margin-top: 12px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.metric {
  border: 1px solid #f3d9cf;
  background: #fff7f3;
  border-radius: 8px;
  padding: 10px 12px;
}
.metric-label {
  font-size: 12px;
  color: #666;
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}
.metric-value {
  font-size: 13px;
  color: #333;
}
.clock-icon,
.spark-icon {
  width: 10px;
  height: 10px;
  background: #ff6b6b;
  display: inline-block;
  border-radius: 999px;
}
.other-style {
  margin-top: 14px;
  color: #222;
  font-size: 14px;
}
.other-style .star {
  color: #ff6b6b;
  margin-right: 6px;
}
.result-card {
  border: 1px solid #f3d9cf;
  border-radius: 12px;
  background: #fff;
  overflow: hidden;
}
.result-card__title {
  padding: 10px 12px;
  border-bottom: 1px solid #f3d9cf;
  background: #fff;
  font-weight: 700;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.result-canvas {
  padding: 12px;
}
.canvas-ph {
  width: 100%;
  height: 420px;
  background: #000;
  border-radius: 8px;
}
.result-footer {
  padding: 12px;
  border-top: 1px solid #f3d9cf;
  background: #fff6f2;
}
.orig-label {
  font-size: 12px;
  color: #6f7275;
}
.orig-value {
  margin-top: 4px;
  color: #ff6b6b;
  font-weight: 700;
}
.orig-value.link {
  text-decoration: none;
}
.result-note {
  margin-top: 6px;
  font-size: 11px;
  color: #9aa0a6;
  display: flex;
  align-items: center;
  gap: 6px;
}
.info-icon {
  width: 10px;
  height: 10px;
  background: #ff9f8a;
  border-radius: 999px;
  display: inline-block;
}
.download-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 16px;
}
.download-left {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
}
.dl-icon {
  width: 10px;
  height: 10px;
  background: #ff6b6b;
  border-radius: 999px;
  display: inline-block;
}
.download-btn {
  appearance: none;
  border: none;
  background: #ef6d65;
  color: #fff;
  border-radius: 10px;
  padding: 12px 18px;
  font-weight: 700;
  cursor: pointer;
}
.download-btn .btn-icon {
  width: 10px;
  height: 10px;
  background: #fff;
  border-radius: 999px;
  display: inline-block;
  margin-right: 6px;
}
</style>

